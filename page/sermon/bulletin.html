<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì£¼ë³´ ì•ˆë‚´</title>
  <link rel="stylesheet" href="/style/style.css">
  <link rel="stylesheet" href="/style/page.css">
  <link rel="stylesheet" href="/style/sermon.css">
</head>
<body>  
  <div id="header"></div>
  <main>
    <section class="bulletin">
      <h2>êµíšŒ ì£¼ë³´</h2>
      <div class="bulletin-content">
        <!-- ì—°ë„ë³„ ì„¹ì…˜ë“¤ì´ ìë™ìœ¼ë¡œ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
        <div id="bulletin-years">
          <p>ì£¼ë³´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>

        <p style="margin-top: 2rem; color: #666; font-size: 0.9rem;">
          ğŸ’¡ ì£¼ê°„/ì›”ê°„ êµíšŒ ì£¼ë³´ë¥¼ PDFë¡œ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. <br>
          ğŸ’¡ ì£¼ë³´ê°€ ë³´ì´ì§€ ì•Šìœ¼ì‹œë©´ ë¸Œë¼ìš°ì €ì—ì„œ PDF ë·°ì–´ë¥¼ í™œì„±í™”í•´ì£¼ì„¸ìš”.
        </p>
      </div>

      <script>
        fetch('/header.html')
          .then(res => res.text())
          .then(data => { document.getElementById('header').innerHTML = data; });
        fetch('/footer.html')
          .then(res => res.text())
          .then(data => { document.getElementById('footer').innerHTML = data; });

        // ì£¼ë³´ ë°ì´í„° ë¡œë“œ (GitHub Actionsë¡œ ìë™ ì—…ë°ì´íŠ¸ëœ JSON ì‚¬ìš©)
        async function loadBulletinData() {
          try {
            const res = await fetch('/bulletins.json');
            if (!res.ok) {
              throw new Error(`ì£¼ë³´ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${res.status}`);
            }
            return await res.json();
          } catch (error) {
            console.error('ì£¼ë³´ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error.message);
            return [];
          }
        }

        // "YYYY.MM.DD" â†’ Date
        function toDateSafe(dateStr, fallbackCreatedTime) {
          try {
            const d = new Date((dateStr || '').replace(/\./g, '-'));
            if (!isNaN(d.getTime())) return d;
          } catch (e) {}
          return new Date(fallbackCreatedTime || 0);
        }

        // bulletin.dateì—ì„œ ì—°ë„ ì¶”ì¶œ
        function getYear(bulletin) {
          // dateê°€ "2026.02.15" í˜•íƒœë¼ì„œ ì• 4ìë¦¬ë©´ ì¶©ë¶„
          const y = (bulletin?.date || '').slice(0, 4);
          return /^\d{4}$/.test(y) ? y : 'ê¸°íƒ€';
        }

        function bulletinCardHTML(bulletin) {
          return `
            <div class="bulletin-card">
              <div class="bulletin-date">${bulletin.date}</div>
              <h3 class="bulletin-title">${bulletin.name}</h3>
              <div class="bulletin-actions">
                <a href="${bulletin.viewLink}" target="_blank" class="bulletin-btn view-btn">ğŸ“– ë³´ê¸°</a>
                <a href="${bulletin.downloadLink}" target="_blank" class="bulletin-btn download-btn">ğŸ“¥ ë‹¤ìš´ë¡œë“œ</a>
              </div>
            </div>
          `;
        }

        function attachToggleBehavior(grid, btn) {
          const cards = grid.querySelectorAll('.bulletin-card');
          let expanded = false;

          function getCardHeight(n) {
            if (cards.length === 0) return 0;
            const card = cards[0];
            const style = window.getComputedStyle(grid);
            const gap = parseFloat(style.gap) || 0;

            const cardsPerRow = Math.floor(grid.offsetWidth / card.offsetWidth) || 1;
            const rowCount = Math.ceil(n / cardsPerRow);

            const cardHeight = card.offsetHeight || 250;
            return rowCount * cardHeight + (rowCount - 1) * gap + 20;
          }

          function updateView() {
            if (expanded) {
              grid.style.maxHeight = getCardHeight(cards.length) + 'px';
            } else {
              grid.style.maxHeight = getCardHeight(4) + 'px'; // ê¸°ë³¸ 4ê°œë§Œ
            }
            btn.setAttribute('aria-label', expanded ? 'ì ‘ê¸°' : 'ë”ë³´ê¸°');
            btn.classList.toggle('open', expanded);
          }

          btn.addEventListener('click', () => {
            expanded = !expanded;
            updateView();
          });

          window.addEventListener('resize', updateView);

          // ì¹´ë“œê°€ 4ê°œ ì´í•˜ë©´ ë²„íŠ¼ ìˆ¨ê¹€
          if (cards.length <= 4) {
            btn.style.display = 'none';
            grid.style.maxHeight = 'none';
            return;
          }

          updateView();
        }

        loadBulletinData().then(bulletins => {
          const container = document.getElementById('bulletin-years');

          if (!bulletins || bulletins.length === 0) {
            container.innerHTML = '<p>ë“±ë¡ëœ ì£¼ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
          }

          // ì „ì²´ ìµœì‹ ìˆœ ì •ë ¬ (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
          bulletins.sort((a, b) => {
            const dateA = toDateSafe(a.date, a.createdTime);
            const dateB = toDateSafe(b.date, b.createdTime);

            if (dateA.getTime() === dateB.getTime() && a.createdTime && b.createdTime) {
              return new Date(b.createdTime) - new Date(a.createdTime);
            }
            return dateB - dateA;
          });

          // ì—°ë„ë³„ ê·¸ë£¹í•‘
          const byYear = new Map();
          for (const b of bulletins) {
            const y = getYear(b);
            if (!byYear.has(y)) byYear.set(y, []);
            byYear.get(y).push(b);
          }

          // ì—°ë„ ì •ë ¬: ìµœì‹  ì—°ë„(í° ìˆ«ì)ë¶€í„°, 'ê¸°íƒ€'ëŠ” ë§ˆì§€ë§‰
          const years = Array.from(byYear.keys()).sort((a, b) => {
            if (a === 'ê¸°íƒ€') return 1;
            if (b === 'ê¸°íƒ€') return -1;
            return Number(b) - Number(a);
          });

          // ì„¹ì…˜ HTML ìƒì„±
          container.innerHTML = years.map(year => {
            const safeYear = String(year).replace(/[^\wê°€-í£-]/g, '');
            const sectionId = `bulletin-section-${safeYear}`;
            const gridId = `bulletin-list-${safeYear}`;
            const btnId = `toggle-bulletin-${safeYear}`;
            const arrowId = `arrow-${safeYear}`;

            return `
              <div id="${sectionId}" class="bulletin-year-section">
                <div class="sermon-section-title-wrap" style="display:flex;align-items:center;justify-content:space-between;">
                  <div class="sermon-section-title">${year}ë…„ ì£¼ë³´</div>
                  <button id="${btnId}" class="bulletin-toggle-btn" style="background:none;border:none;cursor:pointer;font-size:2rem;line-height:1;outline:none;padding:0 0.5rem;" aria-label="ë”ë³´ê¸°">
                    <span id="${arrowId}" class="bulletin-arrow-icon">â–¼</span>
                  </button>
                </div>
                <hr class="section-divider">
                <div id="${gridId}" class="bulletin-grid"></div>
              </div>
            `;
          }).join('');

          // ê° ì„¹ì…˜ì— ì¹´ë“œ ë Œë”ë§ + í† ê¸€ ê¸°ëŠ¥ ì—°ê²°
          for (const year of years) {
            const safeYear = String(year).replace(/[^\wê°€-í£-]/g, '');
            const grid = document.getElementById(`bulletin-list-${safeYear}`);
            const btn = document.getElementById(`toggle-bulletin-${safeYear}`);

            const list = byYear.get(year) || [];
            grid.innerHTML = list.map(bulletinCardHTML).join('');

            attachToggleBehavior(grid, btn);
          }

        }).catch(error => {
          console.error('ì£¼ë³´ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
          document.getElementById('bulletin-years').innerHTML =
            '<p>ì£¼ë³´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</p>';
        });
      </script>

      <style>
        /* ê¸°ì¡´ bulletin-grid ë“± ìŠ¤íƒ€ì¼ì€ ê·¸ëŒ€ë¡œ ë‘ë˜, ë”ë³´ê¸° ë²„íŠ¼/í™”ì‚´í‘œëŠ” "í´ë˜ìŠ¤ ê¸°ë°˜"ìœ¼ë¡œ ìˆ˜ì • */

        .bulletin-toggle-btn {
          color: #666;
          transition: transform 0.3s ease, color 0.2s ease;
        }
        .bulletin-toggle-btn:hover { color: #333; }

        .bulletin-arrow-icon {
          display: inline-block;
          transition: transform 0.3s ease;
        }

        /* ë²„íŠ¼ì— open ë¶™ìœ¼ë©´ ì•ˆì˜ í™”ì‚´í‘œ íšŒì „ */
        .bulletin-toggle-btn.open .bulletin-arrow-icon {
          transform: rotate(180deg);
        }
      </style>

  <style>
    .bulletin-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 1.2rem;
      margin-top: 1.5rem;
      overflow: hidden;
      transition: max-height 0.4s ease-in-out;
      max-height: 600px; /* ì´ˆê¸° ë†’ì´ ì„¤ì • */
    }

    .bulletin-card {
      background: #f0f4ff;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: transform 0.2s, box-shadow 0.2s, background 0.2s;
    }

    .bulletin-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    }

    .bulletin-date {
      color: #666;
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
    }

    .bulletin-title {
      color: #2c3e50;
      font-size: 1.1rem;
      margin-bottom: 1rem;
      font-weight: 600;
    }

    .bulletin-actions {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .bulletin-btn {
      display: inline-block;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      text-decoration: none;
      font-size: 0.9rem;
      font-weight: 500;
      transition: background 0.2s;
    }

    .view-btn {
      background: #5a6fd8;
      color: white;
    }

    .view-btn:hover {
      background: #222567;
    }

    .download-btn {
      background: #95a5a6;
      color: white;
    }

    .download-btn:hover {
      background: #222567;
      color: white;
    }

    /* ì„¤êµ í˜ì´ì§€ì™€ ë™ì¼í•œ ë”ë³´ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    #toggle-bulletin-list {
      color: #666;
      transition: transform 0.3s ease;
    }

    #toggle-bulletin-list:hover {
      color: #333;
    }

    #toggle-bulletin-list.open #arrow-icon {
      transform: rotate(180deg);
    }

    #arrow-icon {
      transition: transform 0.3s ease;
    }

    @media (max-width: 1200px) {
      .bulletin-grid {
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      }
    }

    @media (max-width: 768px) {
      .bulletin-grid {
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1rem;
      }
      
      .bulletin-actions {
        flex-direction: column;
      }
      
      .bulletin-btn {
        text-align: center;
      }
    }

    @media (max-width: 480px) {
      .bulletin-grid {
        grid-template-columns: 1fr;
      }
    }
    
    /* sermon.cssì™€ ë™ì¼í•œ ëª¨ë°”ì¼ ë°˜ì‘í˜• ìŠ¤íƒ€ì¼ ì¶”ê°€ */
    @media (max-width: 1024px) {
      .sermon-section-title {
        font-size: 1.6rem;
        margin: 1.8rem 0 1rem 0;
      }
      
      .bulletin-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 1.8rem;
      }
      
      .bulletin-card {
        padding: 1.2rem;
      }
      
      .bulletin-title {
        font-size: 1rem;
      }
      
      .bulletin-btn {
        font-size: 0.95rem;
        padding: 0.5em 1.2em;
      }
      
      #toggle-bulletin-list {
        font-size: 1.5rem;
      }
      
      .bulletin-content p {
        font-size: 0.8rem;
      }
    }
    
    @media (max-width: 600px) {
      .bulletin-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 1.5rem;
      }
      
      .bulletin-card {
        padding: 1rem;
        min-height: auto !important;
        min-width: auto !important;
      }
      
      .bulletin-title {
        font-size: 0.9rem;
        margin-bottom: 0.8rem;
      }
      
      .bulletin-date {
        font-size: 0.8rem;
      }
      
      .bulletin-btn {
        font-size: 0.85rem;
        padding: 0.4em 0.8em;
      }
      
      #toggle-bulletin-list {
        font-size: 1.8rem;
      }
      
      .bulletin-content p {
        font-size: 0.8rem;
      }
    }

    @media (max-width: 480px) {
      .sermon-section-title {
        font-size: 1rem !important;
        margin: 0.8rem 0 0.5rem 0 !important;
      }
      
      .bulletin-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 1.2rem !important;
      }
      
      .bulletin-card {
        padding: 1rem !important;
        min-height: auto !important;
        min-width: auto !important;
      }
      
      .bulletin-title {
        font-size: 0.9rem;
        margin-bottom: 0.5rem !important;
      }
      
      .bulletin-date {
        font-size: 0.8rem !important;
      }
      
      .bulletin-btn {
        font-size: 0.8rem !important;
        padding: 0.3em 0.6em !important;
      }
      
      #toggle-bulletin-list {
        font-size: 1.6rem !important;
      }
      
      .bulletin-content p {
        font-size: 0.7rem !important;
      }
    }

    @media (max-width: 380px) {
      .sermon-section-title {
        font-size: 1rem !important;
        margin: 0.8rem 0 0.5rem 0 !important;
      }
      
      .bulletin-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 1.2rem;
      }
      
      .bulletin-card {
        padding: 0.5rem !important;
        min-height: auto !important;
        min-width: auto !important;
      }
      
      .bulletin-title {
        font-size: 0.8rem !important;
        margin-bottom: 0.5rem !important;
      }
      
      .bulletin-date {
        font-size: 0.7rem !important;
      }
      
      .bulletin-btn {
        font-size: 0.75rem !important;
        padding: 0.3em 0.6em !important;
      }
      
      #toggle-bulletin-list {
        font-size: 1.5rem !important;
      }
      
      .bulletin-content p {
        font-size: 0.7rem !important;
      }
    }
  </style>
</body>
</html> 