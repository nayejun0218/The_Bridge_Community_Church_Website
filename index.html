<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Bridge Community Church</title>
  <link rel="stylesheet" href="/style/style.css">
  <link rel="stylesheet" href="/style/home_sermon.css">
  <link rel="stylesheet" href="/style/page.css">
  <!-- AOS ì• ë‹ˆë©”ì´ì…˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <link rel="stylesheet" href="https://unpkg.com/aos@2.3.4/dist/aos.css" />
</head>
<body>
  <div id="scroll-progress"></div>
  <div id="header"></div>
  <main>
    <div class="banner-slider">
      <img src="/images/major_banner.png" class="banner-img active" alt="ë°°ë„ˆ1">
      <div class="banner-dots">
        <span class="dot active"></span>
        <span class="dot"></span>
      </div>
    </div>
    <section class="welcome-section" data-aos="fade-up">
      <div class="welcome-text">
        <h2 id="main-typing-text">í–‰ë³µí•œ ì‚¶, í™”ëª©í•œ êµíšŒë¡œ<br>ë‹¹ì‹ ì„ ì´ˆëŒ€í•©ë‹ˆë‹¤.</h2>
        <p><strong>ìƒ¬ë¡¬!</strong> ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ ì•„ë¦„ë™ì— ìœ„ì¹˜í•œ<br>
        "ë”ë¸Œë¦¿ì§€ì»¤ë®¤ë‹ˆí‹° êµíšŒ"ë¥¼ ë°©ë¬¸í•˜ì‹  ì—¬ëŸ¬ë¶„ì„<br>
        ì£¼ë‹˜ì˜ ì´ë¦„ìœ¼ë¡œ í™˜ì˜í•˜ê³  ì¶•ë³µí•©ë‹ˆë‹¤.</p>
      </div>
      <div class="welcome-image">
        <img src="/images/preview/bridge_entrance.jpg" alt="êµíšŒ ì „ê²½" class="preview-img-set">
      </div>
    </section>
    <div class="guide-section" data-aos="fade-up">
      <h2 class="bible-series-title">êµíšŒ ì•ˆë‚´</h2>
      <hr>
      <div class="guide-cards">
        <a href="/page/church-intro/preview.html" class="guide-card-link"><div class="guide-card">ğŸ§­ ì²˜ìŒ ì˜¤ì…¨ë‚˜ìš”?</div></a>
        <a href="/page/church-intro/pastor.html" class="guide-card-link"><div class="guide-card">ğŸ‘¤ ë‹´ì„ëª©ì‚¬ ì†Œê°œ</div></a>
        <a href="/page/notice/bulletin.html" class="guide-card-link"><div class="guide-card">ğŸ“° ì£¼ë³´ ë³´ê¸°</div></a>
        <a href="/page/ministry/worship.html" class="guide-card-link"><div class="guide-card">ğŸ“… ì˜ˆë°°ì‹œê°„ ë³´ê¸°</div></a>
        <a href="/page/notice/location.html" class="guide-card-link"><div class="guide-card">ğŸš— ì°¾ì•„ì˜¤ì‹œëŠ” ê¸¸</div></a>
        <a href="/page/contact/contact.html" class="guide-card-link"><div class="guide-card">ğŸ’¬ ë¬¸ì˜ì‚¬í•­</div></a>
      </div>
    </div>
    <div class="bible-series-section" data-aos="fade-up">
      <h2 class="bible-series-title" id="bible-series-title">ì„±ê²½ ê°•í•´ ì‹œë¦¬ì¦ˆ</h2>
      <hr>
      <div class="bible-series-slider-wrapper">
        <button class="slider-prev">â€¹</button>
        <div id="sermon-cards" class="bible-series-slider"></div>
        <button class="slider-next">â€º</button>
      </div>
    </div>
    <div class="bible-series-section" data-aos="fade-up">
      <h2 class="bible-series-title" id="shorts-series-title">1ë¶„ ë§ì”€ ì‹œë¦¬ì¦ˆ</h2>
      <hr>
      <div class="bible-series-slider-wrapper">
        <button class="slider-prev-shorts">â€¹</button>
        <div id="shorts-cards" class="bible-series-slider"></div>
        <button class="slider-next-shorts">â€º</button>
      </div>
    </div>
    <div class="bridge-social-section" data-aos="fade-up">
      <h2 class="bible-series-title">ì˜¨ë¼ì¸ì—ì„œ ë” ê°€ê¹Œì´</h2>
      <hr>
      <div class="bridge-social-cards">
        <a href="https://www.youtube.com/@TheBridgeCommunity__Church/videos" target="_blank" class="bridge-social-card-link">
          <div class="bridge-social-card">
            <img src="/images/logo/youtube-logo.png" alt="ìœ íŠœë¸Œ" class="bridge-social-logo">
            <span class="bridge-social-text">â–¶ ì´ë²ˆ ì£¼ ì„¤êµ ë§ì”€ ë°”ë¡œê°€ê¸°</span>
          </div>
        </a>
        <a href="https://www.instagram.com/thebridgecommunity__church/" target="_blank" class="bridge-social-card-link">
          <div class="bridge-social-card">
            <img src="/images/logo/instagram_logo.png" alt="ì¸ìŠ¤íƒ€ê·¸ë¨" class="bridge-social-logo">
            <span class="bridge-social-text">â¤ï¸ êµíšŒ ì¼ìƒ/ì†Œì‹ ë³´ê¸°</span>
          </div>
        </a>
        <a href="https://blog.naver.com/atomnkt" target="_blank" class="bridge-social-card-link">
          <div class="bridge-social-card">
            <img src="/images/logo/naverblog_logo.png" alt="ë„¤ì´ë²„ ë¸”ë¡œê·¸" class="bridge-social-logo">
            <span class="bridge-social-text">âœï¸ êµíšŒ ì†Œì‹ ë° ì¹¼ëŸ¼</span>
          </div>
        </a>
      </div>
    </div>
    <section class="home-bridge-summary" data-aos="fade-up">
      <div class="welcome-bridge-message">ë”ë¸Œë¦¿ì§€ì»¤ë®¤ë‹ˆí‹°êµíšŒëŠ” ìš°ë¦¬ì˜ ì‚· ì†ì—ì„œ í•˜ë‚˜ë‹˜ê³¼ ì‚¬ëŒì„ ì—°ê²°í•˜ëŠ” ë”°ëœ»í•œ ê³µë™ì²´ê°€ ë˜ê¸¸ ì†Œë§í•©ë‹ˆë‹¤.<br>ì–¸ì œë“ ì§€ ë°©ë¬¸í•´ ì£¼ì„¸ìš”!</div>
    </section>
  </main>
  <div id="footer"></div>
  <script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
  <script src="/main.js"></script>
  <script>
    // í‘¸í„° ë¡œë“œ
    fetch('footer.html')
      .then(res => res.text())
      .then(data => { document.getElementById('footer').innerHTML = data; });

    let currentIndex = 0;
    let cardsData = [];
    let currentShortsIndex = 0;
    let shortsData = [];
    
    // ë“œë˜ê·¸ ê´€ë ¨ ë³€ìˆ˜ë“¤
    let isDragging = false;
    let startX = 0;
    let scrollLeft = 0;
    let dragStartIndex = 0;
    let currentSlider = null;

    function getCardsPerPage() {
      if (window.innerWidth <= 700) return 1;
      if (window.innerWidth <= 900) return 2;
      return 3;
    }

    // ë“œë˜ê·¸ ì‹œì‘
    function handleDragStart(e, sliderType) {
      isDragging = true;
      currentSlider = sliderType;
      startX = e.pageX || e.touches[0].pageX;
      dragStartIndex = sliderType === 'sermon' ? currentIndex : currentShortsIndex;
      
      const slider = document.getElementById(sliderType === 'sermon' ? 'sermon-cards' : 'shorts-cards');
      slider.style.cursor = 'grabbing';
      slider.style.userSelect = 'none';
      slider.classList.add('dragging');
      
      // ì „í™˜ ì• ë‹ˆë©”ì´ì…˜ ë¹„í™œì„±í™”
      const track = slider.querySelector('.bible-series-slider-track');
      if (track) {
        track.style.transition = 'none';
      }
    }

    // ë“œë˜ê·¸ ì¤‘
    function handleDragMove(e) {
      if (!isDragging || !currentSlider) return;
      
      e.preventDefault();
      const currentX = e.pageX || e.touches[0].pageX;
      const deltaX = currentX - startX;
      
      const track = document.querySelector(currentSlider === 'sermon' ? 
        '.bible-series-slider-track:not(.shorts-slider-track)' : 
        '.shorts-slider-track');
      
      if (track && track.children.length > 0) {
        // ì‹¤ì œ ì¹´ë“œ ë„ˆë¹„ ê³„ì‚°
        const cardWidth = track.children[0].offsetWidth;
        const currentIdx = currentSlider === 'sermon' ? currentIndex : currentShortsIndex;
        const cardsPerPage = getCardsPerPage();
        
        // ì´ ì¹´ë“œ ìˆ˜ì™€ ìµœëŒ€ ì¸ë±ìŠ¤ ê³„ì‚°
        const totalCards = currentSlider === 'sermon' ? 
          cardsData.length + 1 : shortsData.length + 1;
        const maxIndex = Math.max(0, totalCards - cardsPerPage);
        
        // ë“œë˜ê·¸ë¡œ ì´ë™í•  ì˜ˆìƒ ì¹¸ ìˆ˜ ê³„ì‚°
        const dragDistance = Math.abs(deltaX);
        const cardsMoved = Math.round(dragDistance / cardWidth);
        
        // ì˜ˆìƒ ìƒˆ ì¸ë±ìŠ¤ ê³„ì‚°
        let projectedIndex = currentIdx;
        if (deltaX > 0) {
          // ì˜¤ë¥¸ìª½ìœ¼ë¡œ ë“œë˜ê·¸ (ì´ì „ìœ¼ë¡œ)
          projectedIndex = Math.max(0, currentIdx - cardsMoved);
        } else if (deltaX < 0) {
          // ì™¼ìª½ìœ¼ë¡œ ë“œë˜ê·¸ (ë‹¤ìŒìœ¼ë¡œ)
          projectedIndex = Math.min(maxIndex, currentIdx + cardsMoved);
        }
        
        // ê²½ê³„ ì²˜ë¦¬ ë° ì €í•­ íš¨ê³¼
        let limitedDeltaX = deltaX;
        const beyondBoundary = (projectedIndex <= 0 && deltaX > 0) || 
                              (projectedIndex >= maxIndex && deltaX < 0);
        
        if (beyondBoundary) {
          // ê²½ê³„ë¥¼ ë„˜ì–´ì„œë©´ ì €í•­ íš¨ê³¼
          limitedDeltaX = deltaX * 0.3;
        }
        
        const baseTransform = currentIdx * cardWidth;
        
        // ì‹¤ì‹œê°„ìœ¼ë¡œ ë§ˆìš°ìŠ¤ ì›€ì§ì„ì— ë”°ë¼ ìŠ¬ë¼ì´ë” ì´ë™
        track.style.transform = `translateX(-${baseTransform - limitedDeltaX}px)`;
      }
    }

    // ë“œë˜ê·¸ ì¢…ë£Œ
    function handleDragEnd(e) {
      if (!isDragging || !currentSlider) return;
      
      const currentX = e.pageX || e.changedTouches[0].pageX;
      const deltaX = currentX - startX;
      
      const slider = document.getElementById(currentSlider === 'sermon' ? 'sermon-cards' : 'shorts-cards');
      const track = slider.querySelector('.bible-series-slider-track');
      
      slider.style.cursor = 'grab';
      slider.style.userSelect = 'auto';
      slider.classList.remove('dragging');
      
      if (track && track.children.length > 0) {
        // ì „í™˜ ì• ë‹ˆë©”ì´ì…˜ ë‹¤ì‹œ í™œì„±í™” (ì´ë™ ê±°ë¦¬ì— ë”°ë¼ ì• ë‹ˆë©”ì´ì…˜ ì‹œê°„ ì¡°ì •)
        const dragDistance = Math.abs(deltaX);
        const cardWidth = track.children[0].offsetWidth;
        const cardsMoved = Math.round(dragDistance / cardWidth);
        const animationDuration = Math.min(0.5, Math.max(0.2, cardsMoved * 0.15));
        track.style.transition = `transform ${animationDuration}s ease-out`;
        
        // ì¹´ë“œ í˜ì´ì§€ ê³„ì‚°
        const cardsPerPage = getCardsPerPage();
        const minThreshold = cardWidth * 0.2; // ìµœì†Œ 20% ë“œë˜ê·¸í•´ì•¼ ì´ë™
        
        let newIndex;
        if (currentSlider === 'sermon') {
          newIndex = currentIndex;
          const totalCards = cardsData.length + 1;
          const maxIndex = Math.max(0, totalCards - cardsPerPage);
          
          if (dragDistance > minThreshold) {
            if (deltaX > 0) {
              // ì˜¤ë¥¸ìª½ìœ¼ë¡œ ë“œë˜ê·¸ (ì´ì „ìœ¼ë¡œ)
              newIndex = Math.max(0, currentIndex - cardsMoved);
            } else {
              // ì™¼ìª½ìœ¼ë¡œ ë“œë˜ê·¸ (ë‹¤ìŒìœ¼ë¡œ)
              newIndex = Math.min(maxIndex, currentIndex + cardsMoved);
            }
          }
          
          currentIndex = newIndex;
          updateSlider();
        } else {
          newIndex = currentShortsIndex;
          const totalShortsCards = shortsData.length + 1;
          const maxIndex = Math.max(0, totalShortsCards - cardsPerPage);
          
          if (dragDistance > minThreshold) {
            if (deltaX > 0) {
              // ì˜¤ë¥¸ìª½ìœ¼ë¡œ ë“œë˜ê·¸ (ì´ì „ìœ¼ë¡œ)
              newIndex = Math.max(0, currentShortsIndex - cardsMoved);
            } else {
              // ì™¼ìª½ìœ¼ë¡œ ë“œë˜ê·¸ (ë‹¤ìŒìœ¼ë¡œ)
              newIndex = Math.min(maxIndex, currentShortsIndex + cardsMoved);
            }
          }
          
          currentShortsIndex = newIndex;
          updateShortsSlider();
        }
      }
      
      isDragging = false;
      currentSlider = null;
    }

    function setupSlider() {
      const container = document.getElementById('sermon-cards');
      container.innerHTML = ''; 
      const track = document.createElement('div');
      track.className = 'bible-series-slider-track';
      
      const sermonCards = cardsData.map(card => `
        <a href="${card.url}" target="_blank" class="sermon-card-link" onclick="return !isDragging">
          <div class="sermon-card">
            <div class="sermon-thumb-wrap">
              <img class="sermon-thumb" src="${card.thumb}" alt="ì¸ë„¤ì¼" draggable="false">
              <img class="youtube-logo" src="/images/logo/youtube-logo.png" alt="YouTube Logo" draggable="false">
            </div>
            <div class="sermon-info">
              <div class="sermon-title">${card.title}</div>
              <div class="sermon-date">${card.date}</div>
            </div>
            <span class="hover-text">ê°•í•´ ë°”ë¡œê°€ê¸°</span>
          </div>
        </a>
      `).join('');
      
      // "ë” ë³´ëŸ¬ê°€ê¸°" ì¹´ë“œ ì¶”ê°€
      const moreCard = `
        <a href="/page/ministry/sermon.html" class="sermon-card-link more-card-link" onclick="return !isDragging">
          <div class="sermon-card more-card">
            <div class="more-card-content">
              <div class="more-icon">ğŸ“–</div>
              <div class="more-title">ì°½ì„¸ê¸° ê°•í•´<br>ë” ë³´ëŸ¬ê°€ê¸°</div>
              <div class="more-description">ì „ì²´ ì„¤êµ ë³´ê¸°</div>
            </div>
          </div>
        </a>
      `;
      
      track.innerHTML = sermonCards + moreCard;
      
      container.appendChild(track);
      
      // ë“œë˜ê·¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      container.addEventListener('mousedown', (e) => handleDragStart(e, 'sermon'));
      container.addEventListener('touchstart', (e) => handleDragStart(e, 'sermon'));
      container.style.cursor = 'grab';
      
      updateSlider();
    }

    function setupShortsSlider() {
      const container = document.getElementById('shorts-cards');
      container.innerHTML = ''; 
      const track = document.createElement('div');
      track.className = 'bible-series-slider-track shorts-slider-track';
      
      const shortsCards = shortsData.map(card => `
        <a href="${card.url}" target="_blank" class="sermon-card-link" onclick="return !isDragging">
          <div class="sermon-card">
            <div class="sermon-thumb-wrap">
              <img class="sermon-thumb" src="${card.thumb}" alt="ì¸ë„¤ì¼" draggable="false">
              <img class="youtube-logo" src="/images/logo/youtube-logo.png" alt="YouTube Logo" draggable="false">
            </div>
            <div class="sermon-info">
              <div class="sermon-title">${card.title}</div>
              <div class="sermon-date">${card.date}</div>
            </div>
            <span class="hover-text">ì‡¼ì¸  ë°”ë¡œê°€ê¸°</span>
          </div>
        </a>
      `).join('');
      
      // "ë” ë³´ëŸ¬ê°€ê¸°" ì¹´ë“œ ì¶”ê°€
      const shortsMoreCard = `
        <a href="/page/ministry/sermon.html" class="sermon-card-link more-card-link" onclick="return !isDragging">
          <div class="sermon-card more-card">
            <div class="more-card-content">
              <div class="more-icon">ğŸ¬</div>
              <div class="more-title">1ë¶„ ë§ì”€<br>ë” ë³´ëŸ¬ê°€ê¸°</div>
              <div class="more-description">ì „ì²´ ì‡¼ì¸  ë³´ê¸°</div>
            </div>
          </div>
        </a>
      `;
      
      track.innerHTML = shortsCards + shortsMoreCard;
      
      container.appendChild(track);
      
      // ë“œë˜ê·¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
      container.addEventListener('mousedown', (e) => handleDragStart(e, 'shorts'));
      container.addEventListener('touchstart', (e) => handleDragStart(e, 'shorts'));
      container.style.cursor = 'grab';
      
      updateShortsSlider();
    }

    function updateSlider() {
      const track = document.querySelector('.bible-series-slider-track:not(.shorts-slider-track)');
      if (!track || !track.children.length) return;

      const cardWidth = track.children[0].offsetWidth;
      track.style.transform = `translateX(-${currentIndex * cardWidth}px)`;
      
      const cardsPerPage = getCardsPerPage();
      const totalCards = cardsData.length + 1; // +1 for "ë” ë³´ëŸ¬ê°€ê¸°" ì¹´ë“œ
      document.querySelector('.slider-prev').disabled = currentIndex === 0;
      document.querySelector('.slider-next').disabled = currentIndex + cardsPerPage >= totalCards;
    }

    function updateShortsSlider() {
      const track = document.querySelector('.shorts-slider-track');
      if (!track || !track.children.length) return;

      const cardWidth = track.children[0].offsetWidth;
      track.style.transform = `translateX(-${currentShortsIndex * cardWidth}px)`;
      
      const cardsPerPage = getCardsPerPage();
      const totalShortsCards = shortsData.length + 1; // +1 for "ë” ë³´ëŸ¬ê°€ê¸°" ì¹´ë“œ
      document.querySelector('.slider-prev-shorts').disabled = currentShortsIndex === 0;
      document.querySelector('.slider-next-shorts').disabled = currentShortsIndex + cardsPerPage >= totalShortsCards;
    }

    // í™ˆ ì„±ê²½ ê°•í•´ ì¹´ë“œ: GitHub Actionsë¡œ ì£¼ê°„ ì—…ë°ì´íŠ¸ëœ JSON ì‚¬ìš©
    fetch('/sermons.json')
      .then(res => res.json())
      .then(data => {
        // ì‹œë¦¬ì¦ˆ í•„í„° ë° ìµœì‹ ìˆœ ìƒìœ„ ì¼ë¶€ë§Œ ë…¸ì¶œ
        cardsData = data.filter(card => card.series === 'ì°½ì„¸ê¸° ê°•í•´').slice(0, 12);
        setupSlider();
        
        // 1ë¶„ ë§ì”€ ì‹œë¦¬ì¦ˆ ë°ì´í„°
        shortsData = data.filter(card => card.series === '1ë¶„ ë§ì”€').slice(0, 12);
        setupShortsSlider();
      })
      .catch(err => console.error('í™ˆ ì„¤êµ ì¹´ë“œ ë¡œë“œ ì‹¤íŒ¨:', err));

    document.addEventListener('DOMContentLoaded', () => {
      // ì „ì—­ ë“œë˜ê·¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      document.addEventListener('mousemove', handleDragMove);
      document.addEventListener('mouseup', handleDragEnd);
      document.addEventListener('touchmove', handleDragMove);
      document.addEventListener('touchend', handleDragEnd);
      
      // ë“œë˜ê·¸ ì¤‘ í˜ì´ì§€ ìŠ¤í¬ë¡¤ ë°©ì§€
      document.addEventListener('touchmove', (e) => {
        if (isDragging) {
          e.preventDefault();
        }
      }, { passive: false });
      
      document.querySelector('.slider-prev').addEventListener('click', () => {
        if (currentIndex > 0) {
          currentIndex--;
          updateSlider();
        }
      });

      document.querySelector('.slider-next').addEventListener('click', () => {
        const cardsPerPage = getCardsPerPage();
        const totalCards = cardsData.length + 1; // +1 for "ë” ë³´ëŸ¬ê°€ê¸°" ì¹´ë“œ
        if (currentIndex + cardsPerPage < totalCards) {
          currentIndex++;
          updateSlider();
        }
      });

      // 1ë¶„ ë§ì”€ ìŠ¬ë¼ì´ë” ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      document.querySelector('.slider-prev-shorts').addEventListener('click', () => {
        if (currentShortsIndex > 0) {
          currentShortsIndex--;
          updateShortsSlider();
        }
      });

      document.querySelector('.slider-next-shorts').addEventListener('click', () => {
        const cardsPerPage = getCardsPerPage();
        const totalShortsCards = shortsData.length + 1; // +1 for "ë” ë³´ëŸ¬ê°€ê¸°" ì¹´ë“œ
        if (currentShortsIndex + cardsPerPage < totalShortsCards) {
          currentShortsIndex++;
          updateShortsSlider();
        }
      });

      window.addEventListener('resize', () => {
        // ì°½ í¬ê¸° ë³€ê²½ ì‹œ ì• ë‹ˆë©”ì´ì…˜ ì—†ì´ ì¦‰ì‹œ ìœ„ì¹˜ ì¡°ì •
        const track = document.querySelector('.bible-series-slider-track:not(.shorts-slider-track)');
        const shortsTrack = document.querySelector('.shorts-slider-track');
        
        if(track) {
            track.style.transition = 'none';
            updateSlider();
            // ì•½ê°„ì˜ ë”œë ˆì´ í›„ ì• ë‹ˆë©”ì´ì…˜ ë‹¤ì‹œ í™œì„±í™”
            setTimeout(() => {
                track.style.transition = 'transform 0.5s ease-in-out';
            }, 50);
        }
        
        if(shortsTrack) {
            shortsTrack.style.transition = 'none';
            updateShortsSlider();
            // ì•½ê°„ì˜ ë”œë ˆì´ í›„ ì• ë‹ˆë©”ì´ì…˜ ë‹¤ì‹œ í™œì„±í™”
            setTimeout(() => {
                shortsTrack.style.transition = 'transform 0.5s ease-in-out';
            }, 50);
        }
      });
      
      const title = document.getElementById('bible-series-title');
      if(title) {
        title.addEventListener('click', () => {
            window.location.href = '/page/ministry/sermon.html';
        });
      }
      
      const shortsTitle = document.getElementById('shorts-series-title');
      if(shortsTitle) {
        shortsTitle.addEventListener('click', () => {
            window.location.href = '/page/ministry/sermon.html';
        });
      }
    });
  </script>
</body>
</html>
